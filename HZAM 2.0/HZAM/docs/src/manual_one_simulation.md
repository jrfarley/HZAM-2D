# Running one simulation

To run a single simulation use the [`HZAM.run_one_HZAM_sim`](@ref) method. 

This method simulates the behaviour of a hybrid zone arising from secondary contact between two species. The carrying capacity of the environment (which is also the starting population size) is specified by `K_total`. The simulation will run for the number of generations specified by the max_generations parameter.

## How the simulation works

The simulation starts by initializing the locations and genotypes for the starting population. At the beginning the range is divided in two with species A occupying the left half of the range and species B occupying the right half. Every individual at the beginning is homozygous for each locus, species A being possessing the '0' alleles and species B possessing the '1' alleles. Locations are generated randomly within the initial range of each species.

The simulation procedes by executing the following steps:
1. Growth rates are calculated based on local population density.
2. Mates are chosen by the females. Each female is presented with a series of potential mates sorted by proximity and they can choose to accept or reject based on mating type compatibility.
3. The number of offspring for each female is determined by their respective growth rates
4. The offspring genotypes are generated by randomly taking one allele for each loci from each parent.
5. The odds of each offspring surviving to adulthood are calculated based on hybrid fitness, and some are discarded.
6. The surviving offspring disperse from the mother's location.
7. The parent generation is removed from the simulation.

## Displaying the simulation as it runs

There are two different ways of plotting the simulation data as it runs.

By setting `do_plot=true` the program defaults to generating a plot of the locations and functional hybrid indices (see [`HZAM.run_one_HZAM_sim`](@ref) for a description of how hybrid indices are calculated). 

To instead create a plot showing the number of individuals with each phenotype for each trait, set `gene_plot=true`.

Plots are updated every 10 generations by default or the interval specified by the `plot_int` parameter. To automatically save each plot to a PNG file set `save_plot=true`. When the simulation is saving the plots sometimes they don't show up on the screen.

## Specifying which data to track.

Setting `track_population_data=true` will make the simulation record a [`HZAM.DataAnalysis.PopulationTrackingData`](@ref) data structure each generation and then output an ordered list of them in the [`HZAM.DataAnalysis.OutputData`](@ref).

[`HZAM.DataAnalysis.PopulationTrackingData`](@ref) stores the overlap, cline width, size, and hybridity of the population. These measures are calculated with respect to the male mating trait.

This data can be plotted by running the [`HZAM.plot_population_tracking_data`](@ref) command.

## Saving simulation output

The [`HZAM.run_one_HZAM_sim`](@ref) method returns a [`HZAM.DataAnalysis.OutputData`](@ref) data structure that has the simulation parameters, the final locations and genotypes of the population, and key statistics on the population recorded at the end of the simulation.

This method does not automatically save the output, so it is recommended that you use the JLD2 packge to save the outcome of each simulation.

An example of how to run a simulation and save the outcome to a file:

```julia
using JLD2
import HZAM

simulation_outcome = HZAM.HZAM.run_one_HZAM_sim(
    0.4, 
    300, 
    0, 
    1.1
)

@save "trial1.JLD2" simulation_outcome
```

## Plotting population data over time

The [`HZAM.plot_population_tracking_data`](@ref) function is used to generate plots of the data collected using the [`HZAM.DataAnalysis.PopulationTrackingData`](@ref) structure.

An example of this function being used:

```julia
using JLD2
import HZAM

outcome = HZAM.run_one_HZAM_sim(0.4, 300, 0.0, 1.1)

@save "plotting_over_time.JLD2" outcome

HZAM.plot_population_tracking_data("plotting_over_time.JLD2")
```




